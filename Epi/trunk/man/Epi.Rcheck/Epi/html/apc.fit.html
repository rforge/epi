<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>R: Fit an Age-Period-Cohort model to tabular data.</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="../../R.css">
</head><body>

<table width="100%" summary="page for apc.fit {Epi}"><tr><td>apc.fit {Epi}</td><td align="right">R Documentation</td></tr></table>
<h2>Fit an Age-Period-Cohort model to tabular data.</h2>


<h3>Description</h3>

<p>
Fits the classical five models to tabulated rate data (cases,
person-years) classified by two of age, period, cohort:
Age, Age-drift, Age-Period, Age-Cohort and Age-period. There are no
assumtions about the age, period or cohort classes being of the same
length, or that tabulation should be only by two of the variables.
Only requires that mean age and period for each tabulation unit is given.
</p>


<h3>Usage</h3>

<pre>
apc.fit( data,
            A,
            P,
            D,
            Y,
        ref.c,
        ref.p,
         model = c("ns","bs","ls","factor"),
       dr.extr = c("weighted","Holford"),
          parm = c("ACP","APC","AdCP","AdPC","Ad-P-C","Ad-C-P","AC-P","AP-C"),
          npar = c( A=5, P=5, C=5 ),
         scale = 1,
         alpha = 0.05,
    print.AOV = TRUE )
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>data</code></td>
<td>
Data frame with (at least) variables, <code>A</code> (age),
<code>P</code> (period), <code>D</code> (cases, deaths) and <code>Y</code>
(person-years). Cohort (date of birth) is computed as <code>P-A</code>.</td></tr>
<tr valign="top"><td><code>A</code></td>
<td>
Age; numerical vector with mean age at diagnosis for each unit.</td></tr>
<tr valign="top"><td><code>P</code></td>
<td>
Period; numerical vector with mean date of diagnosis for each
unit.</td></tr>
<tr valign="top"><td><code>D</code></td>
<td>
Cases, deaths; numerical vector.</td></tr>
<tr valign="top"><td><code>Y</code></td>
<td>
Person-years; numerical vector.</td></tr>
<tr valign="top"><td><code>ref.c</code></td>
<td>
Reference cohort, numerical. Defaults to median date of
birth among cases. If used with <code>parm="AdCP"</code> or <code>parm="AdPC"</code>,
the resdiual cohort effects will be 1 at ref.c</td></tr>
<tr valign="top"><td><code>ref.p</code></td>
<td>
reference period, numerical. Defaults to median date of
diagnosis among cases.</td></tr>
<tr valign="top"><td><code>model</code></td>
<td>
Type of model fitted:
<ul>
<li><code>bs</code> fits a model with B-splines for each of
the terms, with <code>npar</code> parameters for the terms.
<li><code>ns</code> fits a model with natural splines for each of
the terms, with <code>npar</code> parameters for the terms.
<li><code>ls</code> fits a model with linear splines.
<li><code>factor</code> fits a factor model with one parameter
per value of <code>A</code>, <code>P</code> and <code>C</code>. <code>npar</code>
is ignored in this case.</ul> </td></tr>
<tr valign="top"><td><code>dr.extr</code></td>
<td>
How the drift parameter should be extracted from the
age-period-cohort model. <code>weighted</code> (default) lets the
weighted average (by marginal no. cases, <code>D</code>) of the estimated
period and cohort effects have 0 slopw. <code>Holford</code> uses the
naïve average over all values for the estimated effects,
disregarding the no. cases.</td></tr>
<tr valign="top"><td><code>parm</code></td>
<td>
The parametrization of the effects. The first four all
refer to the ML-fit of the Age-Period-Cohort model, the last four
give Age-effects from a smaller model and residuals relative to
this. If one of the latter is chosen, <code>drift</code> is ignored. 
Possible values are:
<ul>
<li><code>ACP</code>: ML-estimates. Age-effects as rates for the
reference cohort. Cohort effects as RR relative to the reference
cohort. Period effects constrained to be 0 on average with 0 slope.
<li><code>APC</code>: ML-estimates. Age-effects as rates for the
reference period. Period effects as RR relative to the reference
period. Cohort effects constrained to be 0 on average with 0 slope.
<li><code>AdCP</code>: ML-estimates. Age-effects as rates for the
reference cohort. Cohort and period effects constrained to be 0 on
average with 0 slope. These effects do not multiply to the fitted
rates, the drift is missing and needs to be included to produce
the fitted values.
<li><code>AdPC</code>: ML-estimates. Age-effects as rates for the
reference period. Cohort and period effects constrained to be 0 on
average with 0 slope. These effects do not multiply to the fitted
rates, the drift is missing and needs to be included to produce
the fitted values.
<li><code>Ad-C-P</code>: Age effects are rates for the reference
cohort in the Age-drift model (cohort drift). Cohort effects are from the model
with cohort alone, using log(fitted values) from the Age-drift
model as offset. Period effects are from the model with period
alone using log(fitted values) from the cohort model as offset.      
<li><code>Ad-P-C</code>: Age effects are rates for the reference
period in the Age-drift model (period drift). Period effects are from the model
with period alone, using log(fitted values) from the Age-drift
model as offset. Cohort effects are from the model with cohort
alone using log(fitted values) from the period model as offset.      
<li><code>AC-P</code>: Age effects are rates for the reference
cohort in the Age-Cohort model, cohort effects are RR relative to
the reference cohort. Period effects are from the model
with period alone, using log(fitted values) from the Age-Cohort
model as offset.
<li><code>AP-C</code>: Age effects are rates for the reference
period in the Age-Period model, period effects are RR relative to
the reference period. Cohort effects are from the model
with cohort alone, using log(fitted values) from the Age-Period
model as offset.
</ul> </td></tr>
<tr valign="top"><td><code>npar</code></td>
<td>
The number of parameters to use for each of the terms in
the model. It can be a list of three numerical vectors, in which case
these taken as the knots for the age, period and cohort effect, the first
and last element in each vector are used as the boundary knots.</td></tr>
<tr valign="top"><td><code>alpha</code></td>
<td>
The significance level. Estimates are given with
(1-<code>alpha</code>) confidence limits.</td></tr>
<tr valign="top"><td><code>scale</code></td>
<td>
numeric(1), factor multiplied to the rate estimates before output.</td></tr>
<tr valign="top"><td><code>print.AOV</code></td>
<td>
Should the analysis of deviance table for the models
be printed?</td></tr>
</table>

<h3>Value</h3>

<p>
An object of class "apc" (recognized by <code><a href="apc.lines.html">apc.lines</a></code> and
<code><a href="apc.plot.html">apc.plot</a></code>) &mdash; a list with components:
</p>
<table summary="R argblock">
<tr valign="top"><td><code>Age</code></td>
<td>
Matrix with 4 colums: <code>A.pt</code> with the ages (equals
<code>unique(A)</code>) and three columns giving the estimated rates with
c.i.s.</td></tr>
<tr valign="top"><td><code>Per</code></td>
<td>
Matrix with 4 colums: <code>P.pt</code> with the dates of
diagnosis (equals <code>unique(P)</code>) and three columns giving the
estimated RRs with c.i.s.</td></tr>
<tr valign="top"><td><code>Coh</code></td>
<td>
Matrix with 4 colums: <code>C.pt</code> with the dates of birth
(equals <code>unique(P-A)</code>) and three columns giving the estimated
RRs with c.i.s.</td></tr>
<tr valign="top"><td><code>Drift</code></td>
<td>
A 3 column matrix with drift-estimates and c.i.s: The first row is
the ML-estimate of the drift (as defined by <code>drift</code>), the
second row is the estimate from the Age-drift model. For the
sequential parametrizations, only the latter is given.</td></tr>
<tr valign="top"><td><code>Ref</code></td>
<td>
Numerical vector of length 2 with reference period and cohort.
If ref.p or ref.c was not supplied the corresponding element is NA.</td></tr>
<tr valign="top"><td><code>AOV</code></td>
<td>
Analysis of deviance table comparing the five classical
models.</td></tr>
<tr valign="top"><td><code>Type</code></td>
<td>
Character string explaining the model and the parametrization.</td></tr>
<tr valign="top"><td><code>Knots</code></td>
<td>
If <code>model</code> is one of <code>"ns"</code> or <code>"bs"</code>, a list
with three components: <code>Age</code>, <code>Per</code>, <code>Coh</code>, each one a
vector of knots. The max and the min are the boundary knots.</td></tr>
<tr valign="top"><td><code>Powers</code></td>
<td>
If <code>model</code> is <code>"fpol"</code>, a list
with three components: <code>Age</code>, <code>Per</code>, <code>Coh</code>, each one a
vector of the powers used in the fractional polynomials.</td></tr>
</table>

<h3>Author(s)</h3>

<p>
Bendix Carstensen, <a href="http://www.pubhealth.ku.dk/~bxc">http://www.pubhealth.ku.dk/~bxc</a>
</p>


<h3>References</h3>

<p>
The considerations behind the parametrizations used in this function
are given in details in a preprint from Department of Biostatistics in Copenhagen:
<a href="http://www.pubhealth.ku.dk/bs/publikationer/rr-06-1.pdf">http://www.pubhealth.ku.dk/bs/publikationer/rr-06-1.pdf</a>.
</p>


<h3>See Also</h3>

<p>
<code><a href="apc.frame.html">apc.frame</a></code>, <code><a href="apc.lines.html">apc.lines</a></code>, <code><a href="apc.plot.html">apc.plot</a></code>.
</p>


<h3>Examples</h3>

<pre>
library( Epi )
data(lungDK)

# Taylor a dataframe that meets the requirements
exd &lt;- lungDK[,c("Ax","Px","D","Y")]
names(exd)[1:2] &lt;- c("A","P")

# Two different ways of parametrizing the APC-model, ML
ex.H &lt;- apc.fit( exd, npar=7, model="ns", dr.extr="Holford",  parm="ACP", scale=10^5 )
ex.W &lt;- apc.fit( exd, npar=7, model="ns", dr.extr="weighted", parm="ACP", scale=10^5 )

# Sequential fit, first AC, then P given AC.
ex.S &lt;- apc.fit( exd, npar=7, model="ns", parm="AC-P", scale=10^5 )

# Show the estimated drifts
ex.H[["Drift"]]
ex.W[["Drift"]]
ex.S[["Drift"]]

# Plot the effects
fp &lt;- apc.plot( ex.H )
apc.lines( ex.W, frame.par=fp, col="red" )
apc.lines( ex.S, frame.par=fp, col="blue" )
</pre>



<hr><div align="center">[Package <em>Epi</em> version 0.8.0 <a href="00Index.html">Index]</a></div>

</body></html>
